{% load humanize %}
{% load static %}
<div class="comment-box border p-3 mb-3 rounded bg-light" id="comment-{{ comment.id }}">
    <div class="d-flex align-items-center mb-2">
        {% if comment.user.photo %}
            <img src="{{ comment.user.photo.url }}"
                alt="Avatar"
                class="rounded-circle me-2 border"
                style="width: 40px; height: 40px; object-fit: cover;">
        {% else %}
            <img src="{% static 'images/default-avatar.png' %}"
                alt="Avatar"
                class="rounded-circle me-2 border"
                style="width: 40px; height: 40px; object-fit: cover;">
        {% endif %}

        <div>
            <strong>{{ comment.user.get_full_name|default:comment.user.email }}</strong><br>
            <small class="text-muted">{{ comment.created_at|naturaltime }}</small>
        </div>
    </div>
    <p>{{ comment.content }}</p>

    <!-- Form Balas -->
    <form 
        hx-post="{% url 'authentication:reply_comment' comment.id %}" 
        hx-target="#replies-{{ comment.id }}" 
        hx-swap="beforeend" 
        hx-on::after-request="this.reset()"  
        class="mb-3"
    >
        {% csrf_token %}
        <textarea name="content" rows="2" class="form-control mb-2" placeholder="Tulis balasan..." required></textarea>
        <button type="submit" class="btn btn-sm btn-primary">Balas</button>
    </form>

    <!-- Form Hapus -->
    <form 
        hx-post="{% url 'authentication:delete_comment' comment.id %}" 
        hx-swap="outerHTML"
        onsubmit="return confirm('Yakin ingin menghapus komentar ini?')"
        style="display:inline-block;"
    >
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-danger">Hapus</button>
    </form>

    <!-- Tempat Nested Replies -->
    <div id="replies-{{ comment.id }}" class="ms-4 mt-3">
        {% for reply in comment.children.all %}
            {% include 'admin/partials/comment_item.html' with comment=reply %}
        {% endfor %}
    </div>
</div>
