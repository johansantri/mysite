{% load humanize %}
{% for reply in comment.replies.all %}
    <div class="comment-box border p-3 mb-3 rounded bg-white" id="comment-{{ reply.id }}">
        <div class="d-flex align-items-center mb-2">
            <img src="{{ reply.user.photo.url|default_if_none:'/static/images/default-avatar.png' }}"
                 alt="Avatar"
                 class="rounded-circle me-2 border"
                 style="width: 30px; height: 30px; object-fit: cover;">
            <div>
                <strong>{{ reply.user.get_full_name|default:reply.user.email }}</strong><br>
                <small class="text-muted">{{ reply.created_at|naturaltime }}</small>
            </div>
        </div>
        <p>{{ reply.content }}</p>

        <div class="d-flex align-items-start mb-3">
            <!-- Form Balas nested -->
            <form 
                hx-post="{% url 'authentication:reply_comment' reply.id %}" 
                hx-target="#replies-{{ reply.id }}" 
                hx-swap="beforeend" 
                class="flex-grow-1 me-2"
            >
                {% csrf_token %}
                <textarea name="content" rows="2" class="form-control mb-2" placeholder="Tulis balasan..." required></textarea>
                <button type="submit" class="btn btn-sm btn-primary">Balas</button>
            </form>

            <!-- Form Hapus nested -->
            <form 
                hx-post="{% url 'authentication:delete_comment' reply.id %}" 
                hx-swap="outerHTML"
                onsubmit="return confirm('Yakin ingin menghapus komentar ini?')"
                style="display:inline-block;"
            >
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-danger mt-auto">Hapus</button>
            </form>
        </div>

        <!-- Recursive nested replies -->
        <div id="replies-{{ reply.id }}" class="ms-4 mt-3">
            {% include 'admin/partials/comment_replies.html' with comment=reply %}
        </div>
    </div>
{% empty %}
    <p class="text-muted">Belum ada balasan.</p>
{% endfor %}
