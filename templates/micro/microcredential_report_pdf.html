<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Laporan Microcredential - {{ micro.title }}</title>
    <style>
        body {
            font-family: sans-serif;
            font-size: 10pt;
            margin: 1cm;
        }

        h1, h2, h3 {
            margin-bottom: 5px;
        }

        .info, .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .info td {
            padding: 4px 8px;
        }

        .table th, .table td {
            border: 1px solid #444;
            padding: 6px;
            text-align: left;
            vertical-align: top;
        }

        .badge-success {
            color: green;
            font-weight: bold;
        }

        .badge-failed {
            color: red;
            font-weight: bold;
        }

        .course-detail {
            margin-top: 5px;
        }

        .course-detail ul {
            margin: 0;
            padding-left: 15px;
        }
    </style>
</head>
<body>
    <h1>Microcredential Report</h1>
    <table class="info">
        <tr>
            <td><strong>Microcredential Title:</strong> {{ micro.title }}</td>
            <td><strong>Date:</strong> {{ current_date|date:"d M Y" }}</td>
        </tr>
        <tr>
            <td><strong>Microcredential ID:</strong> {{ micro.id }}</td>
            <td><strong>Minimum Total Score:</strong> {{ micro.min_total_score|floatformat:0 }}</td>
        </tr>
    </table>

    <h2>Participants</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Name & Email</th>
                <th>University</th>
                <th>Country / Gender</th>
                <th>Score</th>
                <th>Status</th>
                <th>Certificate</th>
                <th>Courses</th>
            </tr>
        </thead>
        <tbody>
            {% for p in participants %}
            <tr>
                <td>
                    <strong>{{ p.full_name }}</strong><br>
                    <small>{{ p.email }}</small>
                </td>
                <td>{{ p.university }}</td>
                <td>{{ p.country }}<br>{{ p.gender }}</td>
                <td>{{ p.total_user_score }} / {{ p.total_max_score }}</td>
                <td>
                    {% if p.microcredential_passed %}
                        <span class="badge-success">Passed</span>
                    {% else %}
                        <span class="badge-failed">Failed</span>
                    {% endif %}
                </td>
                <td>
                    {% if p.certificate_id != "N/A" %}
                        {{ p.certificate_id }}<br>
                        <small>{{ p.issued_at|date:"Y-m-d" }}</small>
                    {% else %}
                        None
                    {% endif %}
                </td>
                <td class="course-detail">
                    <ul>
                        {% for course in p.course_progress %}
                        <li>
                            <strong>{{ course.course_name }}</strong>:
                            Score {{ course.user_score }}/{{ course.max_score }},
                            Min: {{ course.min_score }},
                            {% if course.passed %}
                                <span class="badge-success">Passed</span>
                            {% else %}
                                <span class="badge-failed">Failed</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
