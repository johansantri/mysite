{% extends 'home/tes.html' %}
{% load humanize %}

{% block content %}
<div class="container py-5">
  {% if payment %}
    <div class="card shadow-sm border-0">
      <div class="card-header bg-white border-bottom">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
          <div>
            <h4 class="fw-bold mb-0">Invoice Transaksi</h4>
            <small class="text-muted">ID Transaksi: 
              <code>{{ payment.linked_transaction.id|default:"-" }}</code>
            </small>
          </div>
          <div>
            <span class="badge 
              {% if payment.status == 'completed' %} bg-success
              {% elif payment.status == 'pending' %} bg-warning text-dark
              {% else %} bg-danger {% endif %}">
              {{ payment.get_status_display }}
            </span>
          </div>
        </div>
      </div>
<pre>

</pre>

      <div class="card-body">
        <div class="row gy-4">
          <!-- Informasi Pengguna -->
          <div class="col-md-6">
            <h6 class="fw-semibold mb-3">Informasi Pengguna</h6>
            <ul class="list-unstyled small mb-0">
              <li><strong>Nama:</strong> {{ payment.user.get_full_name|default:payment.user.username }}</li>
              <li><strong>Email:</strong> {{ payment.user.email }}</li>
              <li><strong>IP:</strong> {{ payment.ip_address|default:"-" }}</li>
              <li><strong>User Agent:</strong><br><span class="text-muted">{{ payment.user_agent|default:"-" }}</span></li>
              <li><strong>Lokasi:</strong> {{ payment.location|default:"-" }}</li>
              <li><strong>ISP:</strong> {{ payment.isp|default:"-" }}</li>
            </ul>
          </div>

          <!-- Informasi Kursus -->
          <div class="col-md-6">
            <h6 class="fw-semibold mb-3">Informasi Kursus</h6>
            <ul class="list-unstyled small mb-0">
              <li><strong>Kursus:</strong> {{ payment.course.course_name }}</li>
              <li><strong>ID Kursus:</strong> {{ payment.course.id }}</li>
              <li><strong>Partner:</strong> {{ payment.course.org_partner.name }}</li>
              <li><strong>Model Pembayaran:</strong> {{ payment.get_payment_model_display }}</li>
              {% if transaction.payment_method %}
                <p><strong>Payment Method:</strong> {{ transaction.payment_method }}</p>
              {% endif %}

              {% if transaction.bank_name %}
                <p><strong>Bank:</strong> {{ transaction.bank_name }}</p>
              {% endif %}

              {% if transaction.va_number %}
                <p><strong>VA Number:</strong> {{ transaction.va_number }}</p>
              {% endif %}




              

            </ul>
          </div>
        </div>

        <hr class="my-4">

        <!-- Waktu dan Tagihan -->
        <div class="row gy-3">
          <div class="col-md-6">
            <h6 class="fw-semibold mb-3">Waktu Transaksi</h6>
            <ul class="list-unstyled small mb-0">
              <li><strong>Tanggal Dibuat:</strong> {{ payment.created_at|date:"Y-m-d H:i" }}</li>
              <li><strong>Terakhir Diperbarui:</strong> {{ payment.updated_at|date:"Y-m-d H:i" }}</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h6 class="fw-semibold mb-3">Total Tagihan</h6>
            <p class="fs-4 fw-bold text-success mb-0">Rp {{ payment.amount|floatformat:0|intcomma }}</p>
          </div>
        </div>
      </div>

      <!-- Snapshot Harga -->
      <div class="card-body bg-light border-top">
        <h6 class="fw-semibold mb-3">Rincian Harga Saat Transaksi</h6>
        <div class="row small gy-3">
          <div class="col-md-4">
            <ul class="list-unstyled mb-0">
              <li><strong>Harga Normal:</strong> Rp {{ payment.snapshot_price|intcomma }}</li>
              <li><strong>Diskon:</strong> Rp {{ payment.snapshot_discount|intcomma }}</li>
              <li><strong>Tax (%):</strong> {{ payment.snapshot_tax }}</li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-unstyled mb-0">
              <li><strong>PPN:</strong> Rp {{ payment.snapshot_ppn|intcomma }}</li>
              <li><strong>Total Dibayar:</strong> <span class="fw-bold text-success">Rp {{ payment.snapshot_user_payment|intcomma }}</span></li>
            </ul>
          </div>
          <div class="col-md-4">
            <ul class="list-unstyled mb-0">
              <li><strong>Ke Partner:</strong> Rp {{ payment.snapshot_partner_earning|intcomma }}</li>
              <li><strong>Ke ICE:</strong> Rp {{ payment.snapshot_ice_earning|intcomma }}</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Bukti Pembayaran -->
      {% if payment.proof_of_payment %}
      <div class="card-body border-top">
        <h6 class="fw-semibold mb-3">Bukti Pembayaran</h6>
        <div class="text-center">
          <a href="{{ payment.proof_of_payment.url }}" target="_blank">
            <img src="{{ payment.proof_of_payment.url }}" alt="Bukti Bayar" class="img-fluid img-thumbnail" style="max-width: 400px;">
          </a>
        </div>
      </div>
      {% endif %}

      <!-- Catatan -->
      {% if payment.notes %}
      <div class="card-body border-top bg-white">
        <h6 class="fw-semibold mb-2">Catatan</h6>
        <p class="text-muted small mb-0">{{ payment.notes }}</p>
      </div>
      {% endif %}

      <!-- Tombol Kembali -->
      <div class="card-footer bg-white text-end">
        <a href="{% url 'payments:partner_commission' %}" class="btn btn-outline-secondary btn-sm">‚Üê Kembali ke Laporan</a>
      </div>
    </div>
  {% else %}
    <div class="alert alert-warning text-center" role="alert">
      Transaksi tidak ditemukan.
    </div>
  {% endif %}
</div>
{% endblock %}
