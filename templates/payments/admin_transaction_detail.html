{% extends 'home/tes.html' %}
{% load humanize %}

{% block content %}
<div class=" mt-4">
    <h2>Transaction Details (Admin)</h2>
    <hr>

    <!-- User Information -->
    <h4>User Information</h4>
    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <tr>
                <th>Name</th>
                <td>{{ transaction.user.get_full_name }}</td>
            </tr>
            <tr>
                <th>Email</th>
                <td>{{ transaction.user.email }}</td>
            </tr>
            <tr>
                <th>Phone</th>
                <td>{{ transaction.user.phone }}</td>
            </tr>
        </table>
    </div>

    <!-- Transaction Information -->
    <h4>Transaction Information</h4>
    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <tr>
                <th>Invoice Number</th>
                <td>INV{{ transaction.created_at|date:"Ymd" }}{{ transaction.id }}</td>
            </tr>
            <tr>
                <th>Status</th>
                <td>{{ transaction.status|title }}</td>
            </tr>
            <tr>
                <th>Date</th>
                <td>{{ transaction.created_at|date:"d M Y H:i" }}</td>
            </tr>
            <tr>
                <th>Courses Total</th>
                <td>IDR {{ course_total|floatformat:2|intcomma }}</td>
            </tr>
            <tr>
                <th>Platform Fee</th>
                <td>IDR {{ transaction.platform_fee|floatformat:2|intcomma }}</td>
            </tr>
            <tr class="table-info">
                <th><strong>Total Paid (Grand Total)</strong></th>
                <td><strong>IDR {{ total_paid|floatformat:2|intcomma }}</strong></td>
            </tr>

           
        </table>
    </div>

    <!-- Payment Details -->
    <h4>Payment Details</h4>
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>No</th>
                    <th>Course</th>
                    <th>Partner</th>
                    <th>Original Price</th>
                    <th>Discount</th>
                    <th>Admin Fee</th>
                    <th>VAT</th>
                    <th>Total Paid</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in transaction.payments.all %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ payment.course.course_name }}</td>
                    <td>{{ payment.course.org_partner.name|default:"-" }}</td>
                    <td>IDR {{ payment.snapshot_price|floatformat:2|intcomma }}</td>
                    <td>- IDR {{ payment.snapshot_discount|floatformat:2|intcomma }}</td>
                    <td>+ IDR {{ payment.snapshot_ice_earning|floatformat:2|intcomma }}</td>
                    <td>+ IDR {{ payment.snapshot_ppn|floatformat:2|intcomma }}</td>
                    <td><strong>IDR {{ payment.amount|floatformat:2|intcomma }}</strong></td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center text-muted">No payment records found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Actions -->
    <div class="mt-4 d-flex flex-wrap gap-2">
        {% if transaction.status == 'completed' %}
        <a href="?download=pdf" class="btn btn-primary">Download Invoice PDF</a>
        {% else %}
        <p class="text-warning mb-0">Invoice is only available for completed transactions.</p>
        {% endif %}
        <a href="{% url 'payments:partner_commission' %}" class="btn btn-secondary">Back to Transaction List</a>
    </div>
</div>
{% endblock %}
