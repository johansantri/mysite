{% extends 'home/base.html' %}
{% load humanize %}
{% load static %}
{% block content %}

<!-- Course Content Section -->
<section class="py-8 bg-white font-sans">
    <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2">
                <!-- Overview -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <!-- Inner Banner -->
                    <div class="bg-gray-100 border border-gray-200 rounded-xl p-6 mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">{{ course.course_name }}</h2>
                        <a href="{% url 'courses:category_list' course.category.slug %}" class="inline-block">
                            <span class="inline-block bg-red-500 text-white text-sm font-medium px-3 py-1 rounded-md mb-3">{{ course.category }}</span>
                        </a>
                        <p class="text-gray-600 mb-4">{{ course.sort_description }}</p>
                        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm flex flex-wrap gap-4">
                            <div class="flex items-center">
                                <i class="fas fa-book text-red-500 mr-2"></i>
                                <span class="font-medium">{{ total_sections }} Lessons</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-clock text-red-500 mr-2"></i>
                                <span class="font-medium">{{ total_effort_hours }}hr</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-users text-red-500 mr-2"></i>
                                <span class="font-medium">{{ total_students }} Students</span>
                            </div>
                            <div class="flex items-center">
                                <div class="flex">
                                    {% for i in full_star_range %}
                                        <i class="fas fa-star text-yellow-400"></i>
                                    {% endfor %}
                                    {% if half_star %}
                                        <i class="fas fa-star-half-alt text-yellow-400"></i>
                                    {% endif %}
                                    {% for i in empty_star_range %}
                                        <i class="far fa-star text-gray-400"></i>
                                    {% endfor %}
                                </div>
                                <span class="font-medium ml-2">{{ average_rating }} Rating</span>
                            </div>
                        </div>
                    </div>
                    <h5 class="text-lg font-bold text-gray-900 mb-3">Overview</h5>
                    <hr class="border-gray-300 mb-4">
                    <h6 class="text-md font-semibold text-gray-900 mb-3">Course Description</h6>
                    <p class="text-gray-600">{{ course.description | safe }}</p>
                </div>

                <!-- Course Content -->
                <!-- Course Content -->
                <div class="bg-white rounded-xl shadow-md mt-6 p-6">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                        <h5 class="text-xl font-bold text-gray-900">Course Content</h5>
                        <h6 class="text-gray-500 text-sm mt-2 md:mt-0">Note</h6>
                    </div>
                    <div id="courseAccordion">
                        {% for i in section_data %}
                            {% if not i.children.all %}
                                <div class="bg-blue-100 text-blue-800 p-4 rounded-xl text-sm mb-4">
                                    No sections available yet.
                                </div>
                            {% else %}
                                {% for obj in i.children.all %}
                                    <div x-data="{ open: false }" class="border border-gray-200 rounded-xl mb-4 shadow-sm bg-gray-50">
                                        <h6 class="border-b border-gray-200">
                                            <button 
                                                @click="open = !open"
                                                class="w-full flex justify-between items-center px-4 py-3 font-semibold text-gray-800 bg-gray-100 rounded-t-xl hover:bg-red-500 hover:text-white transition-colors focus:outline-none"
                                                :class="{ 'bg-red-500 text-white': open }"
                                                type="button">
                                                <span>{{ obj.title }}</span>
                                                <i class="fas" :class="open ? 'fa-chevron-up' : 'fa-chevron-down'" x-transition></i>
                                            </button>
                                        </h6>
                                        <div 
                                            x-show="open"
                                            x-transition
                                            class="px-4 py-3">
                                            <ul class="space-y-3">
                                                {% if not obj.children.all %}
                                                    <!-- Materials -->
                                                    {% for material in obj.materials.all %}
                                                        <li class="flex justify-between items-center border-b border-gray-200 pb-2">
                                                            <p class="text-sm text-gray-700">
                                                                <i class="fas fa-file text-red-500 mr-2"></i>{{ material.title }}
                                                            </p>
                                                            <div class="text-sm text-gray-500">{{ material.duration }}</div>
                                                        </li>
                                                    {% empty %}
                                                        <li class="text-gray-400 text-sm">No materials available.</li>
                                                    {% endfor %}
                                                    <!-- Assessments -->
                                                    {% for assesment in obj.assessments.all %}
                                                        <li class="flex justify-between items-center border-b border-gray-200 pb-2">
                                                            <p class="text-sm text-gray-700">
                                                                <i class="fas fa-check text-red-500 mr-2"></i>{{ assesment.name | safe }}
                                                            </p>
                                                            <span class="bg-red-500 text-white text-xs font-semibold px-3 py-1 rounded-full">{{ assesment.weight }}%</span>
                                                        </li>
                                                    {% empty %}
                                                        <li class="text-gray-400 text-sm">No assessments available.</li>
                                                    {% endfor %}
                                                {% else %}
                                                    <!-- Sub-sections -->
                                                    {% for subobj in obj.children.all %}
                                                        <li class="border-b border-gray-200 pb-2">
                                                            <p class="text-sm text-gray-700">
                                                                <i class="fas fa-play-circle text-red-500 mr-2"></i>A.1.1 {{ subobj.title }}
                                                            </p>
                                                        </li>
                                                    {% endfor %}
                                                    <div class="mt-4 flex gap-3">
                                                        <a href="javascript:void(0);" class="bg-red-500 text-white text-sm font-medium px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Add Article</a>
                                                        <a href="javascript:void(0);" class="border border-gray-300 text-sm text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">Add Description</a>
                                                    </div>
                                                {% endif %}
                                            </ul>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Similar Courses -->
                <div class="mt-8">
                    <h2 class="text-2xl font-bold text-gray-900 mb-4 sm:px-3">Similar Courses with <strong>{{ course.instructor.user.first_name }}</strong></h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                        {% for similar_course in similar_courses %}
                            <div>
                                <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                                    {% if similar_course.image %}
                                        <a href="{% url 'courses:course_lms_detail' similar_course.id similar_course.slug %}">
                                            <img src="{{ similar_course.image.url }}" class="w-full h-40 object-cover sm:h-36" alt="{{ similar_course.course_name }}">
                                        </a>
                                    {% else %}
                                        <img src="https://via.placeholder.com/150" class="w-full h-40 object-cover sm:h-36" alt="No Image">
                                    {% endif %}
                                    <div class="p-4">
                                        <h5 class="text-lg font-semibold">
                                            <a href="{% url 'courses:course_lms_detail' similar_course.id similar_course.slug %}" class="text-gray-900 hover:text-red-500 transition-colors">
                                                {{ similar_course.course_name }}
                                            </a>
                                        </h5>
                                    </div>
                                </div>
                            </div>
                        {% empty %}
                            <div class="col-span-full">
                                <div class="bg-yellow-100 text-yellow-800 rounded-xl p-4 text-center sm:px-3">No similar courses available.</div>
                            </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Instructor -->
                <div class="bg-white rounded-xl shadow-md p-6 mt-6">
                    <h5 class="text-lg font-bold text-gray-900 mb-4">About the Instructor</h5>
                    <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-4 flex flex-wrap items-center gap-4">
                        <div class="flex items-center">
                            <div class="mr-3">
                                {% if course.instructor.user.photo %}
                                    <a href="{% url 'courses:instructor_profile' course.instructor.user.username %}">
                                        <img src="{{ course.instructor.user.photo.url }}" alt="Instructor" class="w-16 h-16 object-cover rounded-full border">
                                    </a>
                                {% else %}
                                    <a href="{% url 'courses:instructor_profile' course.instructor.user.username %}">
                                        <img src="{% static 'assets/img/user/user1.jpg' %}" alt="Instructor" class="w-16 h-16 object-cover rounded-full border">
                                    </a>
                                {% endif %}
                            </div>
                            <div>
                                <h5 class="text-md font-bold">
                                    <a href="{% url 'courses:instructor_profile' course.instructor.user.username %}" class="text-gray-900 hover:text-red-500 transition-colors">{{ course.instructor.user.first_name }} {{ course.instructor.user.last_name }}</a>
                                </h5>
                                <p class="text-gray-600 mb-0">{{ course.instructor.user.hobby }}</p>
                            </div>
                        </div>
                        <div class="ml-auto flex items-center">
                            <div class="flex">
                                <i class="fas fa-star text-yellow-400"></i>
                                <i class="fas fa-star text-yellow-400"></i>
                                <i class="fas fa-star text-yellow-400"></i>
                                <i class="fas fa-star text-yellow-400"></i>
                                <i class="fas fa-star text-gray-400"></i>
                            </div>
                            <span class="font-bold ml-1">4.5</span>
                        </div>
                    </div>
                    <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-4 flex flex-wrap gap-4">
                        <div class="flex items-center">
                            <i class="fas fa-play-circle text-red-500 mr-2"></i>
                            <span class="font-medium">{{ instructor_total_courses }} Courses</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-book text-red-500 mr-2"></i>
                            <span class="font-medium">{{ instructor_total_sections }} Sections ({{ instructor_total_materials }} Materials)</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-clock text-red-500 mr-2"></i>
                            <span class="font-medium">{{ instructor_total_effort_hours }} Hours</span>
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-users text-red-500 mr-2"></i>
                            <span class="font-medium">{{ instructor_total_students }} Students</span>
                        </div>
                    </div>
                    <p class="text-gray-600">{{ course.instructor.bio }}</p>
                </div>

                <!-- Reviews -->
                <div class="bg-white rounded-xl shadow-md p-6 mt-6">
                    <h5 class="text-lg font-bold text-gray-900 mb-4">Reviews</h5>
                    {% for review in reviews %}
                        <div class="bg-white border border-gray-200 rounded-xl p-4 shadow-sm mb-4 flex flex-wrap items-center gap-4">
                            <div class="flex items-center">
                                <div class="mr-3">
                                    <a href="{% url 'learner:learner_detail' review.user.username %}" target="_blank">
                                        {% if review.user.photo %}
                                            <img src="{{ review.user.photo.url }}" alt="Reviewer" class="w-16 h-16 object-cover rounded-full border">
                                        {% else %}
                                            <img src="{% static 'images/default_profile.png' %}" alt="Reviewer" class="w-16 h-16 object-cover rounded-full border">
                                        {% endif %}
                                    </a>
                                </div>
                                <div>
                                    <h5 class="text-md font-bold">
                                        <a href="{% url 'learner:learner_detail' review.user.username %}" target="_blank" class="text-gray-900 hover:text-red-500 transition-colors">{{ review.user.username }}</a>
                                    </h5>
                                    <p class="text-gray-600 mb-0">{{ review.user.get_full_name }}</p>
                                </div>
                            </div>
                            <div class="ml-auto flex items-center">
                                {% for i in range %}
                                    <i class="fas fa-star {% if i <= review.rating %}text-yellow-400{% else %}text-gray-400{% endif %}"></i>
                                {% endfor %}
                                <span class="font-bold ml-1">{{ review.rating }}</span>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-3">“{{ review.comment }}”</p>
                    {% empty %}
                        <p class="text-gray-600">Belum ada review untuk kursus ini.</p>
                    {% endfor %}
                    <ul class="flex justify-center gap-2 mt-4">
                        {% if reviews.has_previous %}
                            <li>
                                <a class="px-3 py-1 rounded-md shadow-sm text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors" href="?page=1" aria-label="First">
                                    <i class="fas fa-angle-double-left"></i>
                                </a>
                            </li>
                            <li>
                                <a class="px-3 py-1 rounded-md shadow-sm text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors" href="?page={{ reviews.previous_page_number }}" aria-label="Previous">
                                    <i class="fas fa-angle-left"></i>
                                </a>
                            </li>
                        {% else %}
                            <li class="opacity-50">
                                <span class="px-3 py-1 rounded-md shadow-sm text-gray-400 border border-gray-200"><i class="fas fa-angle-double-left"></i></span>
                            </li>
                            <li class="opacity-50">
                                <span class="px-3 py-1 rounded-md shadow-sm text-gray-400 border border-gray-200"><i class="fas fa-angle-left"></i></span>
                            </li>
                        {% endif %}
                        <li>
                            <span class="bg-red-500 text-white px-4 py-1 rounded-md shadow-sm">
                                {{ reviews.number }} of {{ reviews.paginator.num_pages }}
                            </span>
                        </li>
                        {% if reviews.has_next %}
                            <li>
                                <a class="px-3 py-1 rounded-md shadow-sm text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors" href="?page={{ reviews.next_page_number }}" aria-label="Next">
                                    <i class="fas fa-angle-right"></i>
                                </a>
                            </li>
                            <li>
                                <a class="px-3 py-1 rounded-md shadow-sm text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors" href="?page={{ reviews.paginator.num_pages }}" aria-label="Last">
                                    <i class="fas fa-angle-double-right"></i>
                                </a>
                            </li>
                        {% else %}
                            <li class="opacity-50">
                                <span class="px-3 py-1 rounded-md shadow-sm text-gray-400 border border-gray-200"><i class="fas fa-angle-right"></i></span>
                            </li>
                            <li class="opacity-50">
                                <span class="px-3 py-1 rounded-md shadow-sm text-gray-400 border border-gray-200"><i class="fas fa-angle-double-right"></i></span>
                            </li>
                        {% endif %}
                    </ul>
                </div>

                <!-- Comment Section -->
                <div class="bg-white rounded-xl shadow-md p-6 mt-6">
                    <h5 class="text-lg font-bold text-gray-900 mb-4">Post a Comment</h5>
                    <form method="POST" action="{% url 'courses:add_comment_course' course_id=course.id %}">
                        {% csrf_token %}
                        <div class="mb-3">
                            <textarea name="content" rows="4" class="w-full border border-gray-200 rounded-xl shadow-sm p-3 focus:border-red-500 focus:ring focus:ring-red-100 transition-colors" placeholder="Your Comments" required></textarea>
                        </div>
                        <input type="hidden" name="parent_id" value="">
                        <button type="submit" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">Submit</button>
                    </form>
                </div>

                <!-- Comments -->
                <div class="mt-6">
                    {% for comment in comments %}
                        <div class="bg-white border border-gray-200 rounded-xl p-4 mb-3 shadow-sm hover:shadow-md transition-shadow">
                            <p class="mb-1">
                                <strong class="text-gray-900">{{ comment.user.username }}</strong>
                                <small class="text-gray-600">{{ comment.created_at|date:"F j, Y, g:i a" }}</small>
                            </p>
                            <p class="text-gray-600 mb-2">{{ comment.content }}</p>
                            <div class="text-right">
                                <button class="text-red-500 hover:text-red-600 font-bold text-sm underline" onclick="toggleReplyForm('comment-reply-form-{{ comment.id }}')">
                                    <i class="bi bi-reply-fill mr-1"></i>Reply
                                </button>
                            </div>
                            <div id="comment-reply-form-{{ comment.id }}" class="hidden mt-3">
                                <form method="POST" action="{% url 'courses:add_comment_course' course_id=course.id %}">
                                    {% csrf_token %}
                                    <div class="flex gap-2 mb-2">
                                        <textarea name="content" class="w-full border border-gray-200 rounded-xl shadow-sm p-3 focus:border-red-500 focus:ring focus:ring-red-100 transition-colors" rows="2" placeholder="Reply to this comment..." required></textarea>
                                        <input type="hidden" name="parent_id" value="{{ comment.id }}">
                                        <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Reply</button>
                                    </div>
                                </form>
                            </div>
                            <div class="ml-6">
                                {% for reply in comment.replies.all %}
                                    <div class="bg-gray-50 border border-gray-200 rounded-xl p-4 mt-3 shadow-sm">
                                        <p class="mb-1">
                                            <strong class="text-gray-900">{{ reply.user.username }}</strong>
                                            <small class="text-gray-600">{{ reply.created_at|date:"F j, Y, g:i a" }}</small>
                                        </p>
                                        <p class="text-gray-600 mb-2">{{ reply.content }}</p>
                                        <div class="text-right">
                                            <button class="text-red-500 hover:text-red-600 font-bold text-sm underline" onclick="toggleReplyForm('reply-form-{{ reply.id }}')">
                                                <i class="bi bi-reply-fill mr-1"></i>Reply
                                            </button>
                                        </div>
                                        <div id="reply-form-{{ reply.id }}" class="hidden mt-3">
                                            <form method="POST" action="{% url 'courses:add_comment_course' course_id=course.id %}">
                                                {% csrf_token %}
                                                <div class="flex gap-2 mb-2">
                                                    <textarea name="content" class="w-full border border-gray-200 rounded-xl shadow-sm p-3 focus:border-red-500 focus:ring focus:ring-red-100 transition-colors" rows="2" placeholder="Reply to this comment..." required></textarea>
                                                    <input type="hidden" name="parent_id" value="{{ reply.id }}">
                                                    <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Reply</button>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="ml-6">
                                            {% for sub_reply in reply.replies.all %}
                                                <div class="bg-gray-100 border border-gray-200 rounded-xl p-4 mt-3 shadow-sm">
                                                    <p class="mb-1">
                                                        <strong class="text-gray-900">{{ sub_reply.user.username }}</strong>
                                                        <small class="text-gray-600">{{ sub_reply.created_at|date:"F j, Y, g:i a" }}</small>
                                                    </p>
                                                    <p class="text-gray-600 mb-2">{{ sub_reply.content }}</p>
                                                    <div class="text-right">
                                                        <button class="text-red-500 hover:text-red-600 font-bold text-sm underline" onclick="toggleReplyForm('sub-reply-form-{{ sub_reply.id }}')">
                                                            <i class="bi bi-reply-fill mr-1"></i>Reply
                                                        </button>
                                                    </div>
                                                    <div id="sub-reply-form-{{ sub_reply.id }}" class="hidden mt-3">
                                                        <form method="POST" action="{% url 'courses:add_comment_course' course_id=course.id %}">
                                                            {% csrf_token %}
                                                            <div class="flex gap-2 mb-2">
                                                                <textarea name="content" class="w-full border border-gray-200 rounded-xl shadow-sm p-3 focus:border-red-500 focus:ring focus:ring-red-100 transition-colors" rows="2" placeholder="Reply to this sub-reply..." required></textarea>
                                                                <input type="hidden" name="parent_id" value="{{ sub_reply.id }}">
                                                                <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Reply</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% empty %}
                        <p class="text-gray-600">No comments yet. Be the first to comment!</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:col-span-1">
                <div class="sticky top-20 z-10">
                    <!-- Video -->
                    <div class="mb-6">
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <div class="relative mb-4">
                                {% if course.link_video %}
                                    <a href="{{ course.link_video }}" class="block" data-fancybox="video-gallery">
                                        {% if course.image %}
                                            <img src="{{ course.image.url }}" alt="{{ course.name }} Image" class="w-full h-52 object-cover rounded-xl hover:scale-105 transition-transform">
                                        {% else %}
                                            <img src="{% static 'assets/img/user/logo.5272a797c07c.png' %}" alt="Default Image" class="w-full h-52 object-cover rounded-xl hover:scale-105 transition-transform">
                                        {% endif %}
                                        <div class="absolute inset-0 flex items-center justify-center bg-red-500 bg-opacity-75 rounded-full w-16 h-16 transform -translate-x-1/2 -translate-y-1/2 left-1/2 top-1/2">
                                            <i class="fas fa-play text-white text-2xl"></i>
                                        </div>
                                    </a>
                                {% else %}
                                    <a href="https://www.youtube.com/watch?v=nc6m9WM3Gyw&t=1s" class="block" data-fancybox="video-gallery">
                                        <img src="{% static 'assets/img/user/logo.5272a797c07c.png' %}" alt="Default Image" class="w-full h-52 object-cover rounded-xl hover:scale-105 transition-transform">
                                        <div class="absolute inset-0 flex items-center justify-center bg-red-500 bg-opacity-75 rounded-full w-16 h-16 transform -translate-x-1/2 -translate-y-1/2 left-1/2 top-1/2">
                                            <i class="fas fa-play text-white text-2xl"></i>
                                        </div>
                                    </a>
                                {% endif %}
                            </div>
                            <div class="text-center">
                                {% with course_price=course.get_course_price %}
                                    <div class="mb-4">
                                        {% if course.payment_model == 'free' %}
                                            <h2 class="text-2xl font-bold text-gray-900 mb-1">Free</h2>
                                            <p class="text-gray-600 mb-0">Full access without charge</p>
                                        {% else %}
                                            <h2 class="text-2xl font-bold text-gray-900 mb-1">IDR {{ course_price.user_payment|intcomma }}</h2>
                                            {% if course_price.discount_percent > 0 %}
                                                <p class="text-gray-600 mb-0">
                                                    <span class="line-through">IDR {{ course_price.normal_price|intcomma }}</span>
                                                    <span class="inline-block bg-red-500 text-white text-sm font-medium px-3 py-1 rounded-md">{{ course_price.discount_percent }}% off</span>
                                                </p>
                                            {% endif %}
                                            <p class="text-gray-600 mb-0">
                                                {% if course.payment_model == 'buy_first' %}
                                                    Payment required for enrollment
                                                {% elif course.payment_model == 'pay_for_exam' %}
                                                    Free to enroll, pay at exam
                                                {% elif course.payment_model == 'pay_for_certificate' %}
                                                    Free to enroll and take exam, pay at certificate claim
                                                {% endif %}
                                            </p>
                                        {% endif %}
                                    </div>
                                {% endwith %}
                                <div class="grid grid-cols-2 gap-2 mb-4">
                                    <div>
                                        <a href="#" class="block border border-red-500 text-red-500 px-4 py-2 rounded-lg hover:bg-red-500 hover:text-white transition-colors">
                                            <i class="fas fa-heart mr-1"></i> Wishlist
                                        </a>
                                    </div>
                                    <div>
                                        <button class="block border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors" onclick="openShareWindow()">
                                            <i class="fas fa-share-alt mr-1"></i> Share
                                        </button>
                                    </div>
                                </div>
                                {% for message in messages %}
                                    <div class="bg-{{ message.tags }}-100 text-{{ message.tags }}-800 p-4 rounded-xl mb-4 relative">
                                        {{ message }}
                                        <button type="button" class="absolute top-2 right-2 text-{{ message.tags }}-800" data-bs-dismiss="alert" aria-label="Close">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                {% endfor %}
                                {% if request.user.is_authenticated %}
                                    {% if is_enrolled %}
                                        <a href="{% url 'courses:course_learn' request.user.username course.slug %}" class="block bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Start Course</a>
                                    {% else %}
                                        {% with course_price=course.get_course_price %}
                                            {% if course.payment_model == 'free' %}
                                                <form id="enrollForm" method="POST" action="{% url 'courses:enroll' course.id %}">
                                                    {% csrf_token %}
                                                    <button type="submit" class="block w-full border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors">Enroll Now</button>
                                                </form>
                                            {% else %}
                                                <form method="POST" action="{% url 'payments:add_to_cart' course.id %}">
                                                    {% csrf_token %}
                                                    <button type="submit" class="block w-full bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Add to Cart</button>
                                                </form>
                                            {% endif %}
                                        {% endwith %}
                                    {% endif %}
                                {% else %}
                                    <a href="{% url 'authentication:register' %}?next={% url 'courses:course_lms_detail' id=course.id slug=course.slug %}" class="block bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">Join Now</a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <!-- Features -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h4 class="text-xl font-bold text-gray-900 mb-3">Includes</h4>
                        <ul class="list-none">
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Course Number:</span>
                                <span class="text-gray-600">{{ course.course_number }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Class Run:</span>
                                <span class="text-gray-600">{{ course.course_run }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Class Start:</span>
                                <span class="text-gray-600">{{ course.start_date }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Class End:</span>
                                <span class="text-gray-600">{{ course.end_date }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Enroll Start:</span>
                                <span class="text-gray-600">{{ course.start_enrol }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Enroll End:</span>
                                <span class="text-gray-600">{{ course.end_enrol }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Hours Effort:</span>
                                <span class="text-gray-600">{{ course.hour }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2 border-b border-gray-200">
                                <span class="font-medium text-gray-900">Language:</span>
                                <span class="text-gray-600">{{ course.get_language_display }}</span>
                            </li>
                            <li class="flex justify-between items-center py-2">
                                <span class="font-medium text-gray-900">Level:</span>
                                <span class="text-gray-600">{{ course.level }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>





{% endblock %}