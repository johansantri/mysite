{% extends 'home/tes.html' %}
{% load static %}

{% block content %}

<!-- Dashboard Grid -->
<div class="row justify-content-center g-3">
    <!-- Enrolled Section -->
    <div class="col-lg-4 col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5>Enrolled</h5>
                <h2>{{ total_enrollments }}</h2>
            </div>
        </div>
    </div>
    <!-- Active Courses Section -->
    <div class="col-lg-4 col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5>Active Courses</h5>
                <h2>{{ total_published_courses }}</h2>
            </div>
        </div>
    </div>
    <!-- Partner Section -->
    <div class="col-lg-4 col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5>Partner</h5>
                {% if user.is_superuser %}
                    <h2>{{ total_partners }}</h2>
                {% elif user.is_partner %}
                    <h2>1</h2> <!-- Partner only sees their own organization -->
                {% else %}
                    <h2>0</h2> <!-- Instructors or other users don't manage partners -->
                {% endif %}
            </div>
        </div>
    </div>
    <!-- Students Section -->
    <div class="col-lg-4 col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5>Students</h5>
                <h2>{{ total_learners }}</h2>
            </div>
        </div>
    </div>
    <!-- Courses Section -->
    <div class="col-lg-4 col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5>Courses</h5>
                <h2>{{ total_courses }}</h2>
            </div>
        </div>
    </div>
    <!-- Instructors Section -->
    <div class="col-lg-4 col-md-6">
        <div class="card text-center shadow-sm">
            <div class="card-body">
                <h5>Instructors</h5>
                <h2>{{ total_instructors }}</h2>
            </div>
        </div>
    </div>
</div>
<!-- /Dashboard Grid -->

<!-- Partner-Specific Reports -->
{% if request.user.is_partner %}
    <div class="d-flex justify-content-start gap-3 mt-4">
        <a href="{% url 'partner:partner_course_ratings' %}" class="badge bg-info text-dark p-3 shadow-sm rounded">
            <i class="bi bi-star-half me-1"></i> Rating Report
        </a>
        <a href="{% url 'partner:partner_enrollments' %}" class="badge bg-primary p-3 shadow-sm rounded">
            <i class="bi bi-person-plus me-1"></i> Enrolled Users
        </a>
        <a href="{% url 'partner:partner_course_comments' %}" class="badge bg-warning p-3 shadow-sm rounded">
            <i class="bi bi-chat-left-dots me-1"></i> Comments reports
        </a>
    </div>
{% else %}
    <div class="alert alert-warning mt-4">
        You do not have access to these reports.
    </div>
{% endif %}

<br>

<!-- Recently Created Courses Table -->
<div class="instructor-course-table">
    <div class="dashboard-title">
        <h4>Recently Created Courses</h4>
    </div>
    <div class="table-responsive custom-table">
        {% if courses_created_today %}
            <table class="table table-bordered table-striped mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Courses</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in courses_created_today %}
                    <tr>
                        <td><a href="{% url 'partner:course_lms_detail' course.id course.slug %}">{{ course.course_name }}</a></td>
                        <td>{{ course.created_at|date:"F j, Y" }}</td>
                        <td>{{ course.status_course }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No courses created today.</p>
        {% endif %}
    </div>
</div>

<!-- Pagination Links -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if courses_created_today.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?courses_page=1">First</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?courses_page={{ courses_created_today.previous_page_number }}">Previous</a>
            </li>
        {% endif %}

        <li class="page-item disabled">
            <span class="page-link">Page {{ courses_created_today.number }} of {{ courses_created_today.paginator.num_pages }}</span>
        </li>

        {% if courses_created_today.has_next %}
            <li class="page-item">
                <a class="page-link" href="?courses_page={{ courses_created_today.next_page_number }}">Next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?courses_page={{ courses_created_today.paginator.num_pages }}">Last</a>
            </li>
        {% endif %}
    </ul>
</nav>

{% endblock content %}
