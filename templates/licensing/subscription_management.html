{% extends 'home/tes.html' %}

{% block content %}
    <h2>Subscription Management</h2>
    
    <!-- Tautan untuk menambahkan subscription -->
    <div class="mb-4">
        <a href="{% url 'licensing:create_license' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Add Subscription
        </a>
    </div>
    
    <div class="row">
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">
                    <i class="bi bi-list-check"></i> Total Active Licenses
                </div>
                <div class="card-body">
                    <h5>{{ total_licenses }}</h5>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">
                    <i class="bi bi-file-earmark-x"></i> Total Expired Licenses
                </div>
                <div class="card-body">
                    <h5>{{ total_expired_licenses }}</h5>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-header">
                    <i class="bi bi-calendar-x"></i> Licenses Approaching Expiry
                </div>
                <div class="card-body">
                    <h5>{{ total_approaching_expiry }}</h5>
                </div>
            </div>
        </div>
    </div>

    <h3>Licenses Approaching Expiry</h3>
    {% if approaching_expiry_licenses %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Start Date</th>
                    <th>Expiry Date</th>
                </tr>
            </thead>
            <tbody>
                {% for license in approaching_expiry_licenses %}
                    <tr>
                        <td>{{ license.name }}</td>
                        <td>{{ license.license_type }}</td>
                        <td>{{ license.start_date }}</td>
                        <td>{{ license.expiry_date }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No licenses are approaching expiry in the next 7 days.</p>
    {% endif %}

    <h3>Licenses with Space for More Users</h3>
    {% if licenses_with_space %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Start Date</th>
                    <th>Expiry Date</th>
                    <th>Max Users</th>
                    <th>Current Users</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for license in licenses_with_space %}
                    <tr>
                        <td>{{ license.name }}</td>
                        <td>{{ license.license_type }}</td>
                        <td>{{ license.start_date }}</td>
                        <td>{{ license.expiry_date }}</td>
                        <td>{{ license.max_users }}</td>
                        <td>{{ license.users.count }}</td>
                        <td>{{ license.status|yesno:"Active,Inactive" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No licenses have space for more users.</p>
    {% endif %}
{% endblock %}
