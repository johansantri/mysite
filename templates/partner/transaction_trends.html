{% extends 'home/tes.html' %}
{% load static %}
{% load humanize %}

{% block content %}
<div class="container py-5">
  <div class="text-center mb-4">
    <h2 class="text-primary fw-bold">
      <i class="bi bi-cash-coin me-2"></i>Transaction Trends
    </h2>
    <p class="text-muted lead">
      Monthly summary of transactions and total revenue
    </p>
  </div>

  <div class="d-flex justify-content-center mb-4">
    <a href="{% url 'partner:partner_analytics' %}" class="btn btn-outline-primary">
      <i class="bi bi-bar-chart-line me-2"></i>Back to Main Analytics
    </a>
  </div>

  <div class="card shadow-lg border-0 rounded-4 p-4 mx-auto" style="max-width: 900px;">
    <canvas id="transactionChart" height="300"></canvas>
  </div>
</div>

<script src="{% static 'js/chart.umd.min.js' %}"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/9.0.0/decimal.js" integrity="sha512-j7XClNLgl5hebr3jl5xMoEpuaniuP60N1Sz62xHwJSbuCgUNgP0kDZCGFbUAphBB6dgk7WxMnwKmP6vsY7fV7g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const ctx = document.getElementById("transactionChart").getContext('2d');

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ labels|safe }},
        datasets: [
            {
                label: 'Transaction Count',
                data: {{ transaction_counts|safe }},
                backgroundColor: '#3b82f6',
                borderRadius: 6,
                yAxisID: 'y1'
            },
            {
                label: 'Total Revenue (Rp)',
                data: {{ transaction_totals|safe }},
                type: 'line',
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                tension: 0.3,
                borderWidth: 3,
                pointBackgroundColor: '#10b981',
                yAxisID: 'y2'
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
            mode: 'index',
            intersect: false
        },
        scales: {
            y1: {
                position: 'left',
                title: {
                    display: true,
                    text: 'Number of Transactions'
                },
                beginAtZero: true
            },
            y2: {
                position: 'right',
                title: {
                    display: true,
                    text: 'Revenue (Rp)'
                },
                beginAtZero: true,
                grid: {
                    drawOnChartArea: false
                }
            }
        },
        plugins: {
            legend: {
                position: 'bottom'
            },
            tooltip: {
                backgroundColor: 'rgba(17,24,39,0.9)',
                titleColor: '#fff',
                bodyColor: '#f3f4f6',
                callbacks: {
                    label: ctx => {
                        if (ctx.dataset.label.includes('Revenue')) {
                            return ctx.dataset.label + ': Rp ' + ctx.raw.toLocaleString();
                        } else {
                            return ctx.dataset.label + ': ' + ctx.raw + ' transaction(s)';
                        }
                    }
                }
            }
        }
    }
});
</script>
{% endblock %}
