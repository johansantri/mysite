{% extends 'home/tes.html' %}
{% load humanize %}
{% load static %}

{% block title %}Partners{% endblock %}
{% block meta %}
  <meta name="description" content="Manage and view our partners who collaborate with LMSKu to enhance learning experiences.">
  <meta name="keywords" content="partners, LMSKu, education, management">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="{{ request.build_absolute_uri }}">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Partners - LMSKu">
  <meta property="og:description" content="Manage and view our partners who collaborate with LMSKu to enhance learning experiences.">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:image" content="{% static 'assets/img/partner-og.jpg' %}">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Partners - LMSKu">
  <meta name="twitter:description" content="Manage and view our partners who collaborate with LMSKu to enhance learning experiences.">
  <meta name="twitter:image" content="{% static 'assets/img/partner-og.jpg' %}">
{% endblock %}
{% block content %}

<h1 class="h2">Partners</h1>

{% if request.user.is_superuser or request.user.is_staff %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <a href="{% url 'courses:partner_create_view' %}" class="btn btn-outline-success">Add Partner</a>
        <button class="btn btn-outline-secondary">Export</button>
    </div>
    <form class="d-flex" method="GET" action="">
        <input 
            class="form-control" 
            type="search" 
            name="q" 
            value="{{ request.GET.q }}" 
            placeholder="Search Partner" 
            aria-label="Search">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </form>
</div>

<a href="{% url 'partner:partner_analytics_admin' %}" class="btn btn-outline-info mb-3">
    <i class="bi bi-bar-chart-line"></i> Analytics
</a>
{% endif %}

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>PKP</th>
                <th>Type</th>
                <th>Saldo</th>
                <th>Courses</th>
                <th>Learners</th>
                <th>Instructors</th>
                <th>Rating</th>
                <th>Join Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for partner in page %}
            <tr>
                <td><a href="{% url 'courses:partner_detail' partner.id %}">{{ partner.name }}</a></td>
                <td>{{ partner.user.email }}</td>
                <td>{{ partner.phone }}</td>
                <td>
                    {% if partner.is_pkp %}
                        <span class="badge bg-success">PKP</span>
                    {% else %}
                        <span class="badge bg-secondary">Non-PKP</span>
                    {% endif %}
                </td>
                <td>{{ partner.get_business_type_display }}</td>
                <td>Rp {{ partner.balance_computed|floatformat:0|intcomma }}</td>

                <td>{{ partner.total_courses }}</td>
                <td>{{ partner.total_learners }}</td>
                <td>{{ partner.total_instructors }}</td>
                <td>{{ partner.average_rating|default:"0.0" }}</td>
                <td>{{ partner.created_ad|date:"d M Y" }}</td>
                <td>
                    {% if request.user.is_superuser or request.user.is_staff %}
                        <a href="{% url 'courses:update_partner' partner.id %}" class="btn btn-sm btn-warning">Update</a>
                    {% elif request.user.is_authenticated and request.user.is_partner %}
                        <a href="{% url 'partner:partner_update' partner.id partner.name.slug  %}" class="btn btn-sm btn-warning">Update</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p>Total: {{ count }} | Page {{ page.number }} of {{ page.paginator.num_pages }}</p>

<!-- Pagination -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if page.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Previous</a>
        </li>
        {% endif %}

        {% for num in page.paginator.page_range %}
        <li class="page-item {% if page.number == num %}active{% endif %}">
            <a class="page-link" href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">{{ num }}</a>
        </li>
        {% endfor %}

        {% if page.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Next</a>
        </li>
        {% endif %}
    </ul>
</nav>

{% endblock %}
