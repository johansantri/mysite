{% extends 'home/base.html' %}
{% load static %}

{% block title %}
    {{ partner.name }} - Courses and Details
{% endblock %}

{% block meta %}
    <meta name="description" content="{{ partner.description|striptags|truncatewords:30 }}">
    <meta name="keywords" content="{{ partner.name }}, online courses, {{ partner.address.city|default:'education' }}, {{ categories|join:', ' }}">
    <meta name="robots" content="index, follow">
{% endblock %}

{% block content %}
<main class="bg-gray-100 py-8 font-sans">
    <div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <!-- Partner Info Section -->
        <section class="bg-white rounded-xl shadow-md p-6 mb-6 animate-fade animate-duration-500" aria-labelledby="partner-title">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 items-center">
                <div class="md:col-span-3 text-center md:text-left">
                    {% if partner.logo %}
                        <img src="{{ partner.logo.url }}" 
                             alt="Logo of {{ partner.name }}"
                             class="w-32 h-32 rounded-full shadow-md object-cover mx-auto md:mx-0">
                    {% else %}
                        <img src="https://via.placeholder.com/120" 
                             alt="Default logo for {{ partner.name }}"
                             class="w-32 h-32 rounded-full shadow-md mx-auto md:mx-0">
                    {% endif %}
                </div>
                <div class="md:col-span-9">
                    <h1 class="text-2xl font-bold text-gray-900 mb-2" id="partner-title">{{ partner.name }}</h1>
                    <p class="text-gray-500 text-sm mb-2">
                        <i class="fas fa-building mr-2"></i>{{ partner.kode }} | 
                        <i class="fas fa-calendar-alt mr-2"></i>Join: {{ partner.created_ad|date:"F j, Y" }}
                    </p>
                    <p class="text-gray-900 mb-4 leading-relaxed">{{ partner.description | safe }}</p>
                    <div class="flex flex-wrap gap-4 text-gray-900 text-sm">
                        <span><i class="fas fa-map-marker-alt mr-2 text-red-500"></i>{{ partner.address | safe }}</span>
                        <span><i class="fas fa-phone-alt mr-2 text-red-500"></i>{{ partner.phone | safe }}</span>
                        <span><i class="fas fa-envelope mr-2 text-red-500"></i>{{ partner.email | safe }}</span>
                        <span><i class="fas fa-user mr-2 text-red-500"></i>{{ partner.user.email | safe }}</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Stats and Social Section -->
        <section x-data="{ showTooltip: '' }" class="grid grid-cols-1 md:grid-cols-12 gap-6 mb-6 animate-fade animate-duration-500 animate-delay-200" aria-labelledby="stats-title">
            <div class="md:col-span-8">
                <h2 class="sr-only" id="stats-title">Partner Statistics</h2>
                <div class="flex flex-wrap justify-center md:justify-start gap-4">
                    <!-- Learners -->
                    <div class="flex items-center px-4 py-3 bg-white rounded-lg shadow-md border border-gray-100 hover:shadow-lg transition-shadow"
                         @mouseenter="showTooltip = 'learners'" @mouseleave="showTooltip = ''">
                        <i class="fas fa-users text-2xl text-red-500 mr-3"></i>
                        <div>
                            <p class="font-bold text-gray-900 text-lg">{{ unique_learners }}</p>
                            <small class="text-gray-500">Learners</small>
                        </div>
                        <div x-show="showTooltip === 'learners'" 
                             x-transition 
                             class="absolute z-10 mt-2 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-sm">
                            Total Learners
                        </div>
                    </div>

                    <!-- Reviews -->
                    <div class="flex items-center px-4 py-3 bg-white rounded-lg shadow-md border border-gray-100 hover:shadow-lg transition-shadow"
                         @mouseenter="showTooltip = 'reviews'" @mouseleave="showTooltip = ''">
                        <i class="fas fa-star text-2xl text-yellow-400 mr-3"></i>
                        <div>
                            <p class="font-bold text-gray-900 text-lg">{{ total_reviews }}</p>
                            <small class="text-gray-500">
                                {% if total_reviews > 0 %}
                                    {{ average_rating }}/5
                                {% else %}
                                    No reviews
                                {% endif %}
                            </small>
                        </div>
                        <div x-show="showTooltip === 'reviews'" 
                             x-transition 
                             class="absolute z-10 mt-2 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-sm">
                            Total Reviews
                        </div>
                    </div>

                    <!-- Courses -->
                    <div class="flex items-center px-4 py-3 bg-white rounded-lg shadow-md border border-gray-100 hover:shadow-lg transition-shadow"
                         @mouseenter="showTooltip = 'courses'" @mouseleave="showTooltip = ''">
                        <i class="fas fa-book text-2xl text-green-600 mr-3"></i>
                        <div>
                            <p class="font-bold text-gray-900 text-lg">{{ total_courses }}</p>
                            <small class="text-gray-500">Courses</small>
                        </div>
                        <div x-show="showTooltip === 'courses'" 
                             x-transition 
                             class="absolute z-10 mt-2 px-3 py-2 text-sm text-white bg-gray-900 rounded-lg shadow-sm">
                            Total Courses
                        </div>
                    </div>
                </div>
            </div>

            <div class="md:col-span-4">
                <div class="flex justify-center md:justify-end gap-4">
                    <a href="#" class="text-red-500 text-xl hover:text-red-600 hover:-translate-y-0.5 transition-transform" 
                       aria-label="Visit our Facebook page"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-red-500 text-xl hover:text-red-600 hover:-translate-y-0.5 transition-transform" 
                       aria-label="Visit our Twitter page"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-red-500 text-xl hover:text-red-600 hover:-translate-y-0.5 transition-transform" 
                       aria-label="Visit our LinkedIn page"><i class="fab fa-linkedin-in"></i></a>
                    <a href="#" class="text-red-500 text-xl hover:text-red-600 hover:-translate-y-0.5 transition-transform" 
                       aria-label="Visit our Instagram page"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
        </section>
        <hr class="my-6 border-gray-200">

        <!-- Search and Courses Section -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
            <!-- Sidebar -->
            <aside class="md:col-span-3">
                <div class="sticky top-5">
                    <!-- Search Form -->
                    <form method="get" action="{% url 'courses:org_partner' partner.name.slug %}">
                        <div class="flex mb-6 animate-fade animate-duration-500">
                            <input type="search" 
                                   class="w-full border border-gray-200 rounded-l-lg shadow-sm p-3 focus:border-red-500 focus:ring focus:ring-red-100 transition-colors" 
                                   name="search" 
                                   placeholder="Find courses..." 
                                   value="{{ search_query }}"
                                   aria-label="Search courses">
                            <button class="bg-red-500 text-white px-4 py-3 rounded-r-lg hover:bg-red-600 transition-colors" 
                                    type="submit" 
                                    aria-label="Submit search">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>

                    <!-- Categories -->
                    <div class="bg-white rounded-xl shadow-md p-6 animate-fade animate-duration-500 animate-delay-100">
                        <h2 class="text-lg font-bold text-gray-900 mb-4">Categories</h2>
                        <ul class="space-y-2">
                            <li>
                                <a href="?category=" 
                                   class="flex items-center p-2 rounded-lg text-sm {% if selected_category == '' %}bg-red-500 text-white{% else %}text-gray-900 hover:bg-gray-100 hover:translate-x-1{% endif %} transition-all">
                                    <i class="fas fa-th mr-2"></i> All
                                </a>
                            </li>
                            {% for category in categories %}
                            <li>
                                <a href="?category={{ category.name }}" 
                                   class="flex items-center p-2 rounded-lg text-sm {% if selected_category == category.name %}bg-red-500 text-white{% else %}text-gray-900 hover:bg-gray-100 hover:translate-x-1{% endif %} transition-all">
                                    <i class="fas fa-folder mr-2"></i> {{ category.name }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </aside>

            <!-- Courses Section -->
            <section class="md:col-span-9" aria-labelledby="courses-title">
                <form method="get" action="{% url 'courses:org_partner' partner.name.slug %}">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 animate-fade animate-duration-500">
                        <h2 class="text-xl font-bold text-gray-900" id="courses-title">Courses</h2>
                        <select class="border border-gray-200 rounded-lg shadow-sm p-2 focus:border-red-500 focus:ring focus:ring-red-100 transition-colors" 
                                name="sort_by" 
                                onchange="this.form.submit()" 
                                aria-label="Sort courses">
                            <option value="name" {% if sort_by == 'name' %}selected{% endif %}>Sort by Name</option>
                            <option value="date" {% if sort_by == 'date' %}selected{% endif %}>Sort by Date</option>
                            <option value="learners" {% if sort_by == 'learners' %}selected{% endif %}>Sort by Learners</option>
                        </select>
                    </div>
                    <input type="hidden" name="search" value="{{ search_query }}">
                    <input type="hidden" name="category" value="{{ selected_category }}">
                </form>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for course in courses %}
                    <article>
                        <a href="{% url 'courses:course_lms_detail' course.course_id course.course_slug %}" 
                           class="block bg-white rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all animate-fade animate-duration-500 animate-delay-200" 
                           aria-label="View details for {{ course.course_name }}">
                            <div class="relative overflow-hidden h-44">
                                {% if course.course_image %}
                                    <img src="{{ course.course_image }}"
                                         alt="Thumbnail for {{ course.course_name }}"
                                         class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                                {% else %}
                                    <img src="https://via.placeholder.com/300x180"
                                         alt="Default thumbnail for {{ course.course_name }}"
                                         class="w-full h-full object-cover hover:scale-105 transition-transform duration-300">
                                {% endif %}
                                <span class="absolute top-2 right-2 bg-red-500 text-white text-xs font-medium px-2 py-1 rounded-lg">
                                    {{ course.language|upper }}
                                </span>
                            </div>
                            <div class="p-4 flex flex-col">
                                <h3 class="text-base font-bold text-gray-900 mb-3 truncate" title="{{ course.course_name }}">
                                    {{ course.course_name }}
                                </h3>
                                <div class="flex items-center mb-3">
                                    {% if course.photo %}
                                        <img src="{{ course.photo }}"
                                             alt="Photo of instructor {{ course.instructor }}"
                                             class="w-7 h-7 rounded-full mr-2 object-cover">
                                    {% else %}
                                        <img src="https://via.placeholder.com/28"
                                             alt="Default instructor photo"
                                             class="w-7 h-7 rounded-full mr-2">
                                    {% endif %}
                                    <span class="text-gray-500 text-sm truncate">
                                        {{ course.instructor|default:"No Instructor" }}
                                    </span>
                                </div>
                                <div class="flex flex-wrap gap-2 mb-3">
                                    <span class="bg-gray-100 text-gray-900 text-xs font-medium px-2 py-1 rounded-lg border border-gray-200">
                                        <i class="fas fa-users mr-1"></i> {{ course.num_enrollments }} Learners
                                    </span>
                                    <span class="bg-gray-100 text-gray-900 text-xs font-medium px-2 py-1 rounded-lg border border-gray-200">
                                        <i class="fas fa-clock mr-1"></i> {{ course.hour|default:"N/A" }} Hours
                                    </span>
                                </div>
                                <div class="flex items-center mb-2">
                                    <div class="text-yellow-400 mr-2 flex">
                                        {% for _ in course.full_star_range %}
                                            <i class="fas fa-star text-sm"></i>
                                        {% endfor %}
                                        {% if course.half_star %}
                                            <i class="fas fa-star-half-alt text-sm"></i>
                                        {% endif %}
                                        {% for _ in course.empty_star_range %}
                                            <i class="far fa-star text-sm"></i>
                                        {% endfor %}
                                    </div>
                                    <span class="text-gray-500 text-sm">
                                        ({{ course.average_rating }} / {{ course.review_count }})
                                    </span>
                                </div>
                                <p class="text-gray-900 font-bold text-sm mb-0">Free</p>
                            </div>
                        </a>
                    </article>
                    {% empty %}
                    <div class="col-span-full text-center py-8 animate-fade animate-duration-500">
                        <p class="text-gray-500 text-lg">No related courses found.</p>
                    </div>
                    {% endfor %}
                </div>

                <nav class="flex justify-center mt-8 animate-fade animate-duration-500" aria-label="Course Pagination">
                    <ul class="flex gap-2">
                        {% if page_obj.has_previous %}
                        <li>
                            <a class="inline-flex px-3 py-1 rounded-lg text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors"
                               href="?page=1&category={{ selected_category }}&search={{ search_query }}&sort_by={{ sort_by }}"
                               aria-label="First page">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                        </li>
                        <li>
                            <a class="inline-flex px-3 py-1 rounded-lg text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors"
                               href="?page={{ page_obj.previous_page_number }}&category={{ selected_category }}&search={{ search_query }}&sort_by={{ sort_by }}"
                               aria-label="Previous page">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>
                        {% else %}
                        <li>
                            <span class="inline-flex px-3 py-1 rounded-lg text-gray-400 border border-gray-200"><i class="fas fa-angle-double-left"></i></span>
                        </li>
                        <li>
                            <span class="inline-flex px-3 py-1 rounded-lg text-gray-400 border border-gray-200"><i class="fas fa-angle-left"></i></span>
                        </li>
                        {% endif %}
                        <li>
                            <span class="inline-flex px-4 py-1 rounded-lg bg-red-500 text-white shadow-md">
                                {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                            </span>
                        </li>
                        {% if page_obj.has_next %}
                        <li>
                            <a class="inline-flex px-3 py-1 rounded-lg text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors"
                               href="?page={{ page_obj.next_page_number }}&category={{ selected_category }}&search={{ search_query }}&sort_by={{ sort_by }}"
                               aria-label="Next page">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                        <li>
                            <a class="inline-flex px-3 py-1 rounded-lg text-red-500 border border-gray-200 hover:bg-red-500 hover:text-white transition-colors"
                               href="?page={{ page_obj.paginator.num_pages }}&category={{ selected_category }}&search={{ search_query }}&sort_by={{ sort_by }}"
                               aria-label="Last page">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                        {% else %}
                        <li>
                            <span class="inline-flex px-3 py-1 rounded-lg text-gray-400 border border-gray-200"><i class="fas fa-angle-right"></i></span>
                        </li>
                        <li>
                            <span class="inline-flex px-3 py-1 rounded-lg text-gray-400 border border-gray-200"><i class="fas fa-angle-double-right"></i></span>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </section>
        </div>
    </div>
</main>
{% endblock %}