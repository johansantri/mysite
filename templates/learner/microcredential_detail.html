{% extends 'home/tes.html' %}
{% load static %}
{% block content %}

<!-- Course Content -->
<section class="page-content course-sec py-5 bg-white">
    <div class="container">
        <div class="row g-4">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Overview -->
                <div class="card overview-sec border-0 shadow-sm rounded-3">
                    <div class="card-body p-4">
                        <!-- Inner Banner -->
                        <div class="inner-banner bg-light border rounded-3 p-4 mb-4">
                            <div class="row align-items-center">
                                <div class="col-lg-12">
                                    <h2 class="fw-bold mb-3 text-dark">{{ microcredential.title }}</h2>
                                    <a href="#" class="text-decoration-none">
                                        <span class="badge bg-danger text-white rounded-3 mb-3">
                                            {% if microcredential.category %}{{ microcredential.category }}{% else %}N/A{% endif %}
                                        </span>
                                    </a>
                                    <p class="text-muted mb-0">{{ microcredential.description | safe }}</p>
                                </div>
                            </div>
                        </div>
                        <!-- /Inner Banner -->

                        <!-- Pass/Fail Status -->
                        <div class="alert {% if microcredential_passed %}alert-success{% else %}alert-warning{% endif %} rounded-3 shadow-sm p-4">
                            <h4 class="alert-heading fw-bold">
                                {% if microcredential_passed %}
                                    Congratulations, {{ request.user.username }}!
                                {% else %}
                                    Not Yet Complete
                                {% endif %}
                            </h4>
                            <p>
                                {% if microcredential_passed %}
                                    You have successfully completed this MicroCredential!
                                {% else %}
                                    You need to complete all required courses and achieve a total score of at least {{ min_total_score }} to earn this MicroCredential.
                                {% endif %}
                            </p>
                            <hr>
                            <p class="mb-0"><strong>Your Total Score:</strong> {{ total_user_score|floatformat:2 }} / {{ total_max_score|floatformat:2 }}</p>
                            <p><strong>Minimum Total Score Required:</strong> {{ min_total_score|floatformat:2 }}</p>
                            {% if microcredential_passed %}
                                <div class="mt-3">
                                    <a href="{% url 'courses:generate_microcredential_certificate' microcredential.id %}" class="btn btn-success btn-lg rounded-3 transition-hover">
                                        <i class="fas fa-download me-2"></i> Download Certificate
                                    </a>
                                    <a href="{% url 'courses:add_microcredential_review' microcredential_id=microcredential.id %}" class="btn btn-outline-danger btn-lg rounded-3 transition-hover ms-2">
                                        <i class="fas fa-star me-2"></i> Add a Review
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                        <!-- /Pass/Fail Status -->
                    </div>
                </div>
                <!-- /Overview -->

                <!-- Required Courses -->
                <div class="card content-sec border-0 shadow-sm rounded-3 mt-4">
                    <div class="card-body p-4">
                        <h5 class="subs-title fw-bold text-dark mb-4">Required Courses</h5>
                        <div class="accordion" id="courseAccordion">
                            {% for progress in course_progress %}
                                <div class="accordion-item border-0 rounded-3 mb-3 shadow-sm">
                                    <h6 class="accordion-header" id="heading-{{ progress.course.id }}">
                                        <button class="accordion-button collapsed bg-light rounded-3 fw-semibold text-dark" type="button" data-bs-toggle="collapse" data-bs-target="#course-{{ progress.course.id }}" aria-expanded="false" aria-controls="course-{{ progress.course.id }}">
                                            {{ progress.course.course_name }}
                                            <span class="ms-auto">
                                                {% if progress.passed %}
                                                    <span class="badge bg-success rounded-3">Passed</span>
                                                {% elif progress.completed %}
                                                    <span class="badge bg-warning rounded-3">Completed (Below Minimum)</span>
                                                {% else %}
                                                    <span class="badge bg-danger Rounded-3">Not Completed</span>
                                                {% endif %}
                                            </span>
                                        </button>
                                    </h6>
                                    <div id="course-{{ progress.course.id }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ progress.course.id }}" data-bs-parent="#courseAccordion">
                                        <div class="accordion-body">
                                            <ul class="list-unstyled">
                                                <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                                    <p class="mb-0"><i class="fas fa-book text-danger me-2"></i>Your Score: {{ progress.user_score|floatformat:2 }}</p>
                                                    <p class="mb-0">Max Score: {{ progress.max_score|floatformat:2 }}</p>
                                                </li>
                                                <li class="d-flex justify-content-end py-2">
                                                    <a href="{% url 'learner:course_learn' username=request.user.username id=progress.course.id slug=progress.course.slug %}" class="btn btn-outline-danger btn-sm rounded-3 transition-hover">
                                                        <i class="fas fa-play-circle me-2"></i>Go to Course
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            {% empty %}
                                <div class="alert alert-info rounded-3">No required courses found.</div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- /Required Courses -->
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="sidebar-sec sticky-top" style="top: 80px; z-index: 10;">
                    <!-- Image Section -->
                    <div class="video-sec vid-bg mb-4">
                        <div class="card border-0 shadow-sm rounded-3 overflow-hidden">
                            <div class="card-body p-4">
                                <div class="position-relative mb-3">
                                    {% if microcredential.image %}
                                        <img src="{{ microcredential.image.url }}" alt="{{ microcredential.title }}" class="img-fluid rounded-3 transition-hover" style="width: 100%; height: 200px; object-fit: cover;">
                                    {% else %}
                                        <img src="{% static 'assets/img/user/logo.5272a797c07c.png' %}" alt="Default Image" class="img-fluid rounded-3 transition-hover" style="width: 100%; height: 200px; object-fit: cover;">
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /Image Section -->

                    <!-- Course Information -->
                    <div class="card feature-sec border-0 shadow-sm rounded-3">
                        <div class="card-body p-4">
                            <h4 class="fw-bold text-dark mb-3">Course Information</h4>
                            <ul class="course-details list-unstyled">
                                <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                    <span class="fw-medium text-dark">Category:</span>
                                    <span class="text-muted">{% if microcredential.category %}{{ microcredential.category }}{% else %}N/A{% endif %}</span>
                                </li>
                                <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                    <span class="fw-medium text-dark">Status:</span>
                                    <span class="text-muted">{{ microcredential.status|title }}</span>
                                </li>
                                <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                    <span class="fw-medium text-dark">Start Date:</span>
                                    <span class="text-muted">{% if microcredential.start_date %}{{ microcredential.start_date|date:"M d, Y" }}{% else %}N/A{% endif %}</span>
                                </li>
                                <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                    <span class="fw-medium text-dark">End Date:</span>
                                    <span class="text-muted">{% if microcredential.end_date %}{{ microcredential.end_date|date:"M d, Y" }}{% else %}N/A{% endif %}</span>
                                </li>
                                <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                    <span class="fw-medium text-dark">Created:</span>
                                    <span class="text-muted">{{ microcredential.created_at|date:"M d, Y" }}</span>
                                </li>
                                <li class="d-flex justify-content-between align-items-center py-2 border-bottom">
                                    <span class="fw-medium text-dark">Last Edited:</span>
                                    <span class="text-muted">{{ microcredential.edited_on|date:"M d, Y" }}</span>
                                </li>
                                <li class="d-flex justify-content-between align-items-center py-2">
                                    <span class="fw-medium text-dark">Author:</span>
                                    <span class="text-muted">{{ microcredential.author.username }}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!-- /Course Information -->
                </div>
            </div>
        </div>
    </div>
</section>
<!-- /Course Content -->

<!-- Custom CSS -->
<style>
    /* General Styles */
    .page-content {
        background-color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    .container {
        max-width: 1200px;
    }

    /* Card Styles */
    .card {
        transition: box-shadow 0.3s ease;
        background-color: #ffffff;
        border-radius: 8px !important;
    }

    .card:hover {
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1) !important;
    }

    .transition-hover {
        transition: all 0.3s ease;
    }

    .transition-hover:hover {
        transform: translateY(-2px);
        color: #b02a37 !important;
    }

    /* Inner Banner */
    .inner-banner {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
    }

    /* Accordion */
    .accordion-button:not(.collapsed) {
        background-color: #dc3545 !important;
        color: white !important;
    }

    .accordion-button:focus {
        box-shadow: none;
    }

    /* Buttons */
    .btn-success, .btn-danger {
        border-radius: 8px;
    }

    .btn-success:hover {
        background-color: #218838;
        border-color: #1e7e34;
    }

    .btn-outline-danger {
        border-color: #dc3545;
        color: #dc3545;
    }

    .btn-outline-danger:hover {
        background-color: #dc3545;
        color: white;
    }

    /* Badges */
    .badge {
        font-size: 0.75rem;
        padding: 0.4em 0.8em;
    }

    /* Alerts */
    .alert {
        border: none;
        border-radius: 8px;
    }

    /* Sidebar */
    .sidebar-sec {
        z-index: 10;
    }

    .navbar {
        z-index: 1000 !important;
        position: sticky;
        top: 0;
    }

    /* Responsive Adjustments */
    @media (max-width: 767.98px) {
        .container {
            padding-left: 8px;
            padding-right: 8px;
        }

        .card {
            margin-left: 0;
            margin-right: 0;
            padding: 8px !important;
        }

        .card-body {
            padding: 12px !important;
        }

        .inner-banner {
            margin-left: 0;
            margin-right: 0;
            padding: 10px !important;
        }

        .accordion-item {
            margin-left: 0;
            margin-right: 0;
        }

        .sidebar-sec .card-body {
            padding: 10px !important;
        }

        .video-sec img {
            width: 100%;
            height: auto;
        }
    }
</style>

{% endblock %}