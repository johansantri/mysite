{% extends 'home/base.html' %}
{% load static %}
{% load extra_custom_filters %}

{% block meta %}
    <!-- Standard Meta Tags -->
    <title>{{ learner.first_name }} {{ learner.last_name }} - Learner Profile | LMSKu</title>
    <meta name="description" content="Lihat profil lengkap {{ learner.first_name }} {{ learner.last_name }} di LMSKu. Temukan informasi pribadi, kursus yang telah diselesaikan, dan koneksi sosial.">
    <meta name="keywords" content="{{ learner.first_name }}, {{ learner.last_name }}, LMSKu, learner profile, online learning, {{ learner.hobby|default:'hobi' }}, {{ learner.country|default:'negara' }}, {{ learner.university.name|default:'universitas' }}">
    <meta name="author" content="{{ learner.first_name }} {{ learner.last_name }}">
    <meta name="robots" content="index, follow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="{{ request.build_absolute_uri }}">

    <!-- Open Graph (OG) Tags -->
    <meta property="og:title" content="{{ learner.first_name }} {{ learner.last_name }} - Learner Profile | LMSKu">
    <meta property="og:description" content="Lihat profil {{ learner.first_name }} {{ learner.last_name }} di LMSKu. Informasi pribadi, kursus yang diselesaikan, dan media sosial.">
    <meta property="og:type" content="profile">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    {% if learner.photo %}
        <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ learner.photo.url }}">
    {% else %}
        <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'img/default-avatar.png' %}">
    {% endif %}
    <meta property="og:image:alt" content="Foto profil {{ learner.first_name }} {{ learner.last_name }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="LMSKu">
    <meta property="og:locale" content="id_ID">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ learner.first_name }} {{ learner.last_name }} - Learner Profile | LMSKu">
    <meta name="twitter:description" content="Temukan perjalanan belajar {{ learner.first_name }} di LMSKu, lengkap dengan kursus yang diselesaikan dan profil pribadi.">
    {% if learner.photo %}
        <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ learner.photo.url }}">
    {% else %}
        <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{% static 'img/default-avatar.png' %}">
    {% endif %}
    <meta name="twitter:image:alt" content="Foto profil {{ learner.first_name }} {{ learner.last_name }}">
    <meta name="twitter:site" content="@LMSKuOfficial">

    <!-- Additional SEO Meta Tags -->
    <meta name="geo.placename" content="{{ learner.city|default:'Indonesia' }}">
    <meta name="geo.region" content="{{ learner.country|default:'ID' }}">
    <meta name="language" content="id">
    <meta name="revisit-after" content="7 days">

    <!-- Profile-Specific Meta Tags -->
    <meta property="profile:first_name" content="{{ learner.first_name }}">
    <meta property="profile:last_name" content="{{ learner.last_name }}">
    <meta property="profile:username" content="{{ learner.username }}">
{% endblock %}





{% block content %}
<div class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 text-black bg-white">
    <div class="flex justify-center">
        <!-- Profil Learner -->
        <div class="w-full lg:w-2/3">
            <div class="bg-white rounded-xl overflow-hidden shadow-md border border-gray-200">
                <div class="p-4 md:p-6">
                    <div class="flex flex-col md:flex-row items-center">
                        <div class="md:w-1/3 text-center mb-6 md:mb-0">
                            <div class="w-32 h-32 md:w-40 md:h-40 mx-auto">
                                <img src="{% if learner.photo %}{{ learner.photo.url }}{% else %}{% static 'img/default-avatar.png' %}{% endif %}" 
                                     class="w-full h-full object-cover rounded-full border border-gray-300" 
                                     alt="Profile">
                            </div>
                            <h3 class="font-bold text-black mt-3 text-xl md:text-2xl">{{ learner.first_name }} {{ learner.last_name }}</h3>
                        </div>
                        <div class="md:w-2/3">
                            <h5 class="font-semibold mb-4 text-lg">Personal Information</h5>
                           <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                {% if learner.gender %}
                                    <div class="p-3 rounded border border-gray-200 flex items-center gap-2">
                                        <i class="fas fa-venus-mars"></i><span>{{ learner.get_gender_display }}</span>
                                    </div>
                                {% endif %}
                                {% if learner.education %}
                                    <div class="p-3 rounded border border-gray-200 flex items-center gap-2">
                                        <i class="fas fa-graduation-cap"></i><span>{{ learner.get_education_display }}</span>
                                    </div>
                                {% endif %}
                                {% if learner.country %}
                                    <div class="p-3 rounded border border-gray-200 flex items-center gap-2">
                                        <i class="fas fa-globe"></i><span>{{ learner.country }}</span>
                                    </div>
                                {% endif %}
                                {% if learner.birth %}
                                    <div class="p-3 rounded border border-gray-200 flex items-center gap-2">
                                        <i class="fas fa-birthday-cake"></i><span>{{ learner.birth|mask_year }}</span>
                                    </div>
                                {% endif %}
                                {% if learner.phone %}
                                    <div class="p-3 rounded border border-gray-200 flex items-center gap-2">
                                        <i class="fas fa-phone"></i><span>{{ learner.phone|mask_phone }}</span>
                                    </div>
                                {% endif %}
                                {% if learner.hobby %}
                                    <div class="p-3 rounded border border-gray-200 flex items-center gap-2">
                                        <i class="fas fa-heart"></i><span>{{ learner.hobby }}</span>
                                    </div>
                                {% endif %}
                                {% if learner.university %}
                                    <div class="p-3 rounded border border-gray-200 flex items-center gap-2">
                                        <i class="fas fa-university"></i><span>{{ learner.university.name }}</span>
                                    </div>
                                {% endif %}
                            </div>

                            {% if learner.address %}
                                <div class="mt-3 p-3 rounded border border-gray-200 flex items-start gap-2">
                                    <i class="fas fa-map-marker-alt pt-1 text-gray-500"></i>
                                    <span class="break-words">{{ learner.address }}</span>
                                </div>
                            {% endif %}

                            {% if learner.tiktok or learner.youtube or learner.facebook or learner.instagram or learner.linkedin or learner.twitter %}
                            <h5 class="font-semibold mt-6 mb-3 text-lg">Social Media</h5>
                            <div class="flex flex-wrap gap-2">
                                {% if learner.tiktok %}<a href="{{ learner.tiktok }}" class="w-10 h-10 flex items-center justify-center rounded-full bg-black text-white"><i class="fab fa-tiktok"></i></a>{% endif %}
                                {% if learner.youtube %}<a href="{{ learner.youtube }}" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-900 text-white"><i class="fab fa-youtube"></i></a>{% endif %}
                                {% if learner.facebook %}<a href="{{ learner.facebook }}" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-800 text-white"><i class="fab fa-facebook"></i></a>{% endif %}
                                {% if learner.instagram %}<a href="{{ learner.instagram }}" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-700 text-white"><i class="fab fa-instagram"></i></a>{% endif %}
                                {% if learner.linkedin %}<a href="{{ learner.linkedin }}" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-700 text-white"><i class="fab fa-linkedin-in"></i></a>{% endif %}
                                {% if learner.twitter %}<a href="{{ learner.twitter }}" class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-700 text-white"><i class="fab fa-twitter"></i></a>{% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    {% if instructor %}
                        <div class="mt-6 p-4 rounded border border-gray-200">
                            <h5 class="font-semibold mb-2 text-lg">Instructor Profile</h5>
                            <p class="text-gray-700 mb-3">{{ instructor.bio }}</p>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                <div class="flex items-center gap-2 p-3 rounded border border-gray-200"><i class="fas fa-laptop-code"></i><span>{{ instructor.tech }}</span></div>
                                <div class="flex items-center gap-2 p-3 rounded border border-gray-200"><i class="fas fa-brain"></i><span>{{ instructor.expertise }}</span></div>
                                <div class="flex items-center gap-2 p-3 rounded border border-gray-200"><i class="fas fa-clock"></i><span>{{ instructor.experience_years }} years</span></div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="mt-4 bg-white rounded-xl shadow-md border border-gray-200">
                <div class="border-b border-gray-200 p-3">
                    <h4 class="font-semibold text-lg mb-0">Completed Courses</h4>
                </div>
                <div class="p-4">
                    {% if completed_courses %}
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            {% for course_data in completed_courses %}
                            <a href="{% url 'courses:course_lms_detail' course_data.enrollment.course.id course_data.enrollment.course.slug %}" class="flex items-center p-3 rounded border border-gray-200 hover:bg-gray-100 transition">
                                <i class="fas fa-check-circle text-black text-xl mr-3"></i>
                                <div class="flex-grow">
                                    <h6 class="font-semibold text-black mb-0">{{ course_data.enrollment.course.course_name }}</h6>
                                    <small class="text-gray-500">{{ course_data.enrollment.course.org_partner.name.name }}</small><br>
                                    <small class="text-gray-500">Score: {{ course_data.total_score|floatformat:1 }} / Threshold: {{ course_data.threshold|floatformat:1 }}</small>
                                </div>
                                <span class="bg-black text-white text-xs font-medium px-2 py-1 rounded">{{ course_data.overall_percentage|floatformat:0 }}%</span>
                            </a>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-gray-500 text-center">No completed courses yet. <a href="{% url 'authentication:course_list' %}" class="text-black underline">Explore now</a></p>
                    {% endif %}
                </div>
            </div>

            {% if completed_courses %}
            <div class="mt-6">
                <h5 class="font-semibold text-black mb-3 text-lg">Share This Profile</h5>
                <div class="flex flex-wrap gap-2">
                    <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="px-3 py-1 bg-black text-white rounded text-sm">
                        <i class="fab fa-facebook-f mr-1"></i> Facebook
                    </a>
                    <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text=Lihat%20profil%20{{ learner.username }}" target="_blank" class="px-3 py-1 bg-black text-white rounded text-sm">
                        <i class="fab fa-x-twitter mr-1"></i> X
                    </a>
                    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}" target="_blank" class="px-3 py-1 bg-black text-white rounded text-sm">
                        <i class="fab fa-linkedin-in mr-1"></i> LinkedIn
                    </a>
                    <a href="https://wa.me/?text={{ request.build_absolute_uri|urlencode }}" target="_blank" class="px-3 py-1 bg-black text-white rounded text-sm">
                        <i class="fab fa-whatsapp mr-1"></i> WhatsApp
                    </a>
                    <button id="copyLinkBtn" type="button" class="px-3 py-1 bg-black text-white rounded text-sm">
                        <i class="fas fa-link mr-1"></i> Copy URL
                    </button>
                </div>

                <script>
                document.addEventListener("DOMContentLoaded", function () {
                    const copyBtn = document.getElementById("copyLinkBtn");
                    copyBtn.addEventListener("click", function () {
                        navigator.clipboard.writeText("{{ request.build_absolute_uri }}")
                            .then(() => {
                                copyBtn.innerHTML = '<i class="fas fa-check mr-1"></i> Copied!';
                                setTimeout(() => {
                                    copyBtn.innerHTML = '<i class="fas fa-link mr-1"></i> Copy URL';
                                }, 2000);
                            })
                            .catch(err => {
                                console.error("Failed to copy URL", err);
                            });
                    });
                });
                </script>

            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
