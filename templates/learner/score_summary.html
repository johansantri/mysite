{% extends 'home/tes.html' %}
{% block content %}
<h3>Score Summary - {{ course.course_name }}</h3>

<button type="button" class="btn btn-secondary mb-3" onclick="window.history.back();">
  ← Back
</button>

<div class="table-responsive mb-4">
  <table class="table table-bordered">
    <thead class="table-light">
      <tr>
        <th>Assessment</th>
        <th class="text-center">Max Score</th>
        <th class="text-center">Score</th>
      </tr>
    </thead>
    <tbody>
      {% for result in assessment_results %}
      <tr>
        <td>{{ result.name }}</td>
        <td class="text-center">{{ result.max_score }}</td>
        <td class="text-center">{{ result.score|floatformat:2 }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Info Kelulusan -->
<div class="mb-4">
  <div class="row text-center">
    <div class="col-md-4">
      <div class="card border-primary">
        <div class="card-body">
          <h5 class="card-title">Overall Percentage</h5>
          <p class="display-6">{{ overall_percentage }}%</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-info">
        <div class="card-body">
          <h5 class="card-title">Status</h5>
          <p class="fs-4 {% if status == 'Pass' %}text-success{% else %}text-danger{% endif %}">
            {{ status }}
          </p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card border-warning">
        <div class="card-body">
          <h5 class="card-title">Grade</h5>
          <p class="fs-4">{{ grade }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Progress Bar dengan threshold jelas -->
<div class="card p-4">
  <h5 class="mb-3">Your Grade Progress</h5>
  <div class="progress-container" style="display: flex; flex-direction: column; gap: 1rem;">
    <!-- Progress Bar -->
    <div class="progress" role="progressbar" aria-valuenow="{{ overall_percentage }}" aria-valuemin="0" aria-valuemax="100" aria-label="Grade progress" style="height: 1.5rem; background-color: #f8d7da;">
      {% if overall_percentage >= passing_threshold %}
        <div class="progress-bar bg-danger" style="width: {{ passing_threshold }}%;"></div>
        <div class="progress-bar bg-success" style="width: calc({{ overall_percentage }}% - {{ passing_threshold }}%);"></div>
      {% else %}
        <div class="progress-bar bg-danger" style="width: {{ overall_percentage }}%;"></div>
      {% endif %}
    </div>

    <!-- Threshold and User Markers -->
    <div style="position: relative; display: flex; justify-content: space-between; align-items: center;">
      <div style="text-align: center; flex: 0 0 auto;">
        <span class="badge bg-dark" style="font-size: 0.9rem;">{{ passing_threshold }}%</span>
        <small class="d-block" style="font-size: 0.7rem;">Passing grade</small>
      </div>
      <div style="text-align: center; flex: 0 0 auto;">
        <span class="badge {% if overall_percentage >= passing_threshold %}bg-success{% else %}bg-danger{% endif %}" style="font-size: 0.9rem;">
          {{ overall_percentage }}%
        </span>
        <small class="d-block" style="font-size: 0.7rem;">Your grade</small>
      </div>
    </div>

    <!-- Status Message -->
    <div class="mt-2 p-2 {% if status == 'Pass' %}bg-success-subtle text-success{% else %}bg-danger-subtle text-danger{% endif %} rounded text-center">
      {% if status == 'Pass' %}
        <svg class="bi me-1" width="16" height="16" fill="currentColor"><use xlink:href="#check-circle"/></svg> You’re currently passing this course
      {% else %}
        <svg class="bi me-1" width="16" height="16" fill="currentColor"><use xlink:href="#x-circle"/></svg> You’re currently not passing this course
      {% endif %}
    </div>
  </div>
</div>

<style>
  @media (max-width: 576px) {
    .card { padding: 1rem; }
    .progress { height: 1rem; }
    .badge { font-size: 0.8rem; padding: 0.5rem; }
    small { font-size: 0.6rem; }
  }
</style>

{% endblock %}
